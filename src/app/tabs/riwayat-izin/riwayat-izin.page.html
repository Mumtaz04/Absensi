<ion-header>
  <ion-toolbar color="success" class="custom-toolbar">

    <!-- Tombol Back -->
    <ion-buttons slot="start">
      <ion-button fill="clear" class="back-btn" (click)="onBackPressed()">
        <ion-icon name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>

    <!-- Judul -->
    <ion-title class="toolbar-title">Riwayat Izin</ion-title>

  </ion-toolbar>
</ion-header>

<ion-content class="riwayat-content">

  <!-- ðŸ”¹ Dropdown Filter -->
  <div class="filter-dropdown">
    <ion-select
      interface="popover"
      placeholder="Semua"
      [(ngModel)]="filter"
      (ionChange)="setFilter(filter)"
    >
      <ion-select-option value="semua">Semua</ion-select-option>
      <ion-select-option value="Disetujui">Disetujui</ion-select-option>
      <ion-select-option value="Menunggu">Menunggu</ion-select-option>
      <ion-select-option value="Ditolak">Ditolak</ion-select-option>
    </ion-select>
  </div>

  <!-- ðŸ”¹ Daftar Izin -->
  <div *ngFor="let izin of filteredIzin()" 
      class="izin-card" 
      [ngClass]="izin.status.toLowerCase()">

    <!-- Header -->
    <div class="izin-header">
      <div class="izin-title-wrapper">
        <span class="izin-title">{{ izin.alasan }}</span>
        <p class="izin-date">{{ izin.tanggal }}</p>
      </div>
      <span class="izin-status" [ngClass]="izin.status.toLowerCase()">
        {{ izin.status }}
      </span>
    </div>

    <!-- Divider halus -->
    <div class="izin-divider"></div>

    <!-- Body -->
    <div class="izin-body">
      <p><ion-icon name="time-outline"></ion-icon> Durasi: {{ izin.durasi }}</p>
      <p><ion-icon name="document-text-outline"></ion-icon> {{ izin.deskripsi }}</p>
      <p *ngIf="izin.status === 'Ditolak'" class="alasan">
        Alasan: {{ izin.alasan_ditolak }}
      </p>
    </div>

    <!-- Footer -->
    <div class="izin-footer">
      <span class="footer-text">
        {{ izin.tanggal_tinjau ? 'Ditinjau ' + izin.tanggal_tinjau : '' }}
      </span>
      <a class="detail-btn" (click)="toggleDetail(izin)">Detail</a>
    </div>
  </div>

  <!-- ðŸ”¹ Popup Detail -->
  <div class="overlay" *ngIf="izinTerpilih">
    <div class="detail-popup" [ngClass]="izinTerpilih.status.toLowerCase()">
      <div class="popup-header">
        <h3>Detail</h3>
        <span class="status-badge" [ngClass]="izinTerpilih.status.toLowerCase()">
          {{ izinTerpilih.status }}
        </span>
      </div>

      <p><b>Alasan:</b> {{ izinTerpilih.alasan }}</p>
      <p><b>Deskripsi:</b> {{ izinTerpilih.deskripsi }}</p>
      <p><b>Waktu/durasi cuti:</b> {{ izinTerpilih.tanggal }} ({{ izinTerpilih.durasi }})</p>
      <p><b>Waktu ditinjau:</b> {{ izinTerpilih.tanggal_tinjau || '(Menunggu)' }}</p>

      <div *ngIf="izinTerpilih?.filePendukung?.length">
        <b>File pendukung:</b>
        <div *ngFor="let file of izinTerpilih.filePendukung">
          <a class="file-link" (click)="lihatFile(file.url)">{{ file.nama }}</a>
        </div>
      </div>

      <button class="close-btn" (click)="toggleDetail(null)">Tutup</button>
    </div>
  </div>

</ion-content>
